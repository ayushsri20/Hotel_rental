<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <link rel="stylesheet" href="{% static 'rental/css/theme.css' %}">
  <script defer src="{% static 'rental/js/theme-rotator.js' %}"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Dashboard - Panesar PG</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #D4C5B9 0%, #A39B93 100%) !important;
      min-height: 100vh;
      padding: 20px;
      background-attachment: fixed;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      background: #F5F1ED;
      padding: 25px 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      border: 2px solid #D4A574;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-title h1 {
      color: #8B6F47;
      font-size: 32px;
      font-weight: bold;
    }

    .header-icon {
      font-size: 40px;
    }

    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #8B6F47 0%, #6B5638 100%);
      color: #F5DEB3;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(139, 111, 71, 0.3);
    }

    .btn-secondary {
      background: #E8D7C3;
      color: #6B5638;
    }

    .btn-secondary:hover {
      background: #D4C5B9;
    }

    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .kpi-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid #D4A574;
      transition: all 0.3s ease;
    }

    .kpi-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
    }

    .kpi-label {
      color: #6B5638;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .kpi-value {
      color: #2C1810;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .kpi-subtext {
      color: #8B6F47;
      font-size: 13px;
    }

    .kpi-icon {
      font-size: 28px;
      margin-right: 10px;
    }

    /* Section */
    .section {
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 28px;
      color: #2C1810;
      font-weight: 700;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 3px solid #D4A574;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Collection Table */
    .collection-table {
      width: 100%;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid #D4A574;
    }

    .collection-table thead {
      background: linear-gradient(135deg, #8B6F47 0%, #6B5638 100%);
      color: white;
    }

    .collection-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .collection-table th:last-child {
      border-right: none;
    }

    .collection-table tbody tr {
      border-bottom: 1px solid #E8D7C3;
      transition: background 0.3s ease;
    }

    .collection-table tbody tr:hover {
      background: #FAF7F2;
    }

    .collection-table td {
      padding: 15px;
      border-right: 1px solid #E8D7C3;
      color: #2C1810;
    }

    .collection-table td:last-child {
      border-right: none;
    }

    .room-cell {
      font-weight: 600;
      color: #8B6F47;
    }

    .amount-cell {
      font-weight: 700;
      color: #2C1810;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
    }

    .status-paid {
      background: #D4EDDA;
      color: #155724;
    }

    .status-partial {
      background: #FFF3CD;
      color: #856404;
    }

    .status-pending {
      background: #F8D7DA;
      color: #721C24;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .btn-record {
      background: #8B6F47;
      color: white;
    }

    .btn-record:hover {
      background: #6B5638;
      transform: scale(1.05);
    }

    .btn-view {
      background: #D4A574;
      color: #2C1810;
    }

    .btn-view:hover {
      background: #E8B88A;
    }

    /* Progress Bar */
    .progress-bar-container {
      background: #E8D7C3;
      border-radius: 10px;
      height: 30px;
      overflow: hidden;
      margin: 10px 0;
      border: 1px solid #D4A574;
    }

    .progress-bar-fill {
      background: linear-gradient(90deg, #8B6F47 0%, #6B5638 100%);
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
      transition: width 0.3s ease;
    }

    /* Summary Cards */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid #D4A574;
    }

    .summary-card h3 {
      color: #6B5638;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .summary-value {
      font-size: 28px;
      font-weight: 700;
      color: #2C1810;
      margin-bottom: 8px;
    }

    .summary-detail {
      color: #8B6F47;
      font-size: 13px;
    }

    /* Expense Summary */
    .expense-table {
      width: 100%;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid #D4A574;
      margin-bottom: 30px;
    }

    .expense-table thead {
      background: linear-gradient(135deg, #D4A574 0%, #C09060 100%);
      color: #2C1810;
    }

    .expense-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      border-right: 1px solid rgba(0, 0, 0, 0.1);
    }

    .expense-table tbody tr {
      border-bottom: 1px solid #E8D7C3;
    }

    .expense-table tbody tr:hover {
      background: #FAF7F2;
    }

    .expense-table td {
      padding: 15px;
      border-right: 1px solid #E8D7C3;
      color: #2C1810;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #F5F1ED;
      margin: 5% auto;
      padding: 30px;
      border: 2px solid #D4A574;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #D4A574;
    }

    .modal-header h2 {
      color: #8B6F47;
      font-size: 24px;
    }

    .close-btn {
      background: #E8D7C3;
      color: #6B5638;
      border: none;
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: #D4C5B9;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      color: #6B5638;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #D4A574;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #8B6F47;
      box-shadow: 0 0 0 3px rgba(139, 111, 71, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 20px;
      color: #6B5638;
      font-size: 14px;
      margin-top: 40px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        text-align: center;
      }

      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .collection-table {
        font-size: 13px;
      }

      .collection-table th,
      .collection-table td {
        padding: 10px;
      }

      .summary-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <div class="header-icon">üìä</div>
        <h1>Performance Dashboard</h1>
      </div>
      <div class="header-actions">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
      </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-label">üí∞ Total Collection</div>
        <div class="kpi-value">‚Çπ{{ total_collection|floatformat:0 }}</div>
        <div class="kpi-subtext">From all rooms</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">üìç Total Rooms</div>
        <div class="kpi-value">{{ total_rooms }}</div>
        <div class="kpi-subtext">In complex</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">üë• Occupied</div>
        <div class="kpi-value">{{ occupied_rooms }}</div>
        <div class="kpi-subtext">Rooms with guests</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">‚è≥ Pending Amount</div>
        <div class="kpi-value">‚Çπ{{ pending_amount|floatformat:0 }}</div>
        <div class="kpi-subtext">Due for collection</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">‚ö†Ô∏è Overdue Amount</div>
        <div class="kpi-value">‚Çπ{{ overdue_amount|floatformat:0 }}</div>
        <div class="kpi-subtext">Past due date</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">üí° Electricity Bills</div>
        <div class="kpi-value">‚Çπ{{ total_bills|floatformat:0 }}</div>
        <div class="kpi-subtext">Total pending</div>
      </div>
    </div>

    <!-- Collection by Room -->
    <div class="section">
      <div class="section-title">
        <span>üí≥</span> Room-wise Collection Analysis
      </div>

      <div class="collection-table">
        <table>
          <thead>
            <tr>
              <th>Room #</th>
              <th>Guest Name</th>
              <th>Monthly Rent</th>
              <th>Collected</th>
              <th>Pending</th>
              <th>Collection %</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for room_data in room_collections %}
            <tr>
              <td class="room-cell">{{ room_data.room_number }}</td>
              <td>{{ room_data.guest_name|default:"-" }}</td>
              <td class="amount-cell">‚Çπ{{ room_data.monthly_rent|floatformat:2 }}</td>
              <td class="amount-cell" style="color: #28a745;">‚Çπ{{ room_data.collected|floatformat:2 }}</td>
              <td class="amount-cell" style="color: #dc3545;">‚Çπ{{ room_data.pending|floatformat:2 }}</td>
              <td>
                <div style="margin-bottom: 5px; font-weight: 600; color: #8B6F47;">{{ room_data.collection_percentage
                  }}%</div>
                <div class="progress-bar-container">
                  <div class="progress-bar-fill" style="width: {{ room_data.collection_percentage }}%;">
                    {% if room_data.collection_percentage > 30 %}{{ room_data.collection_percentage }}%{% endif %}
                  </div>
                </div>
              </td>
              <td>
                <span
                  class="status-badge {% if room_data.payment_status == 'paid' %}status-paid{% elif room_data.payment_status == 'partial' %}status-partial{% else %}status-pending{% endif %}">
                  {{ room_data.payment_status|title }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  {% if room_data.monthly_payment_id %}
                  <button class="btn-small btn-record"
                    onclick="openPaymentModal('{{ room_data.monthly_payment_id }}', 'Room {{ room_data.room_number }}')">
                    ‚ûï Record
                  </button>
                  {% else %}
                  <button class="btn-small btn-record" disabled style="opacity: 0.5; cursor: not-allowed;"
                    title="No payment record">
                    ‚ûï Record
                  </button>
                  {% endif %}
                  <button class="btn-small btn-view" onclick="viewRoomDetails('{{ room_data.room_number }}')">
                    üëÅÔ∏è View
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" style="text-align: center; padding: 30px; color: #999;">
                No room data available
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Summary Section -->
    <div class="section">
      <div class="section-title">
        <span>üìà</span> Building Complex Summary
      </div>

      <div class="summary-grid">
        <div class="summary-card">
          <h3>Monthly Expected Collection</h3>
          <div class="summary-value">‚Çπ{{ expected_monthly_collection|floatformat:0 }}</div>
          <div class="summary-detail">From all occupied rooms</div>
        </div>

        <div class="summary-card">
          <h3>Actual Collection This Month</h3>
          <div class="summary-value">‚Çπ{{ collected_this_month|floatformat:0 }}</div>
          <div class="summary-detail">Received so far</div>
        </div>

        <div class="summary-card">
          <h3>Collection Efficiency</h3>
          <div class="summary-value">{{ collection_efficiency }}%</div>
          <div class="summary-detail">{{ collected_this_month|floatformat:0 }} / {{
            expected_monthly_collection|floatformat:0 }}</div>
        </div>
      </div>
    </div>

    <!-- Electricity Bills Summary -->
    <div class="section">
      <div class="section-title">
        <span>‚ö°</span> Electricity Expenses
      </div>

      <div class="expense-table">
        <table>
          <thead>
            <tr>
              <th>Room #</th>
              <th>Month</th>
              <th>Units Consumed</th>
              <th>Bill Amount</th>
              <th>Paid</th>
              <th>Pending</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for bill_data in electricity_bills %}
            <tr>
              <td class="room-cell">{{ bill_data.room_number }}</td>
              <td>{{ bill_data.month|date:"M Y" }}</td>
              <td>{{ bill_data.units_consumed }} units</td>
              <td class="amount-cell">‚Çπ{{ bill_data.bill_amount|floatformat:2 }}</td>
              <td style="color: #28a745; font-weight: 600;">‚Çπ{{ bill_data.paid_amount|floatformat:2 }}</td>
              <td style="color: #dc3545; font-weight: 600;">‚Çπ{{ bill_data.remaining|floatformat:2 }}</td>
              <td>
                <span
                  class="status-badge {% if bill_data.bill_status == 'paid' %}status-paid{% elif bill_data.bill_status == 'partial' %}status-partial{% else %}status-pending{% endif %}">
                  {{ bill_data.bill_status|title }}
                </span>
              </td>
              <td>
                <button class="btn-small btn-record"
                  onclick="openBillPaymentModal('{{ bill_data.bill_id }}', 'Room {{ bill_data.room_number }}')">
                  ‚ûï Record
                </button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" style="text-align: center; padding: 30px; color: #999;">
                No electricity bills available
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Payment Recording Modal -->
    <div id="paymentModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true"
      aria-labelledby="paymentModalTitle" tabindex="-1">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="paymentModalTitle">Record Payment</h2>
          <button type="button" class="close-btn" onclick="closePaymentModal()"
            aria-label="Close payment dialog">&times;</button>
        </div>
        <form method="POST" action="{% url 'record_payment_dashboard' %}" id="paymentForm">
          {% csrf_token %}
          <input type="hidden" name="monthly_payment_id" id="monthlyPaymentId">

          <div class="form-group">
            <label for="roomDisplay">Room</label>
            <input type="text" id="roomDisplay" readonly style="background: #E8D7C3;" aria-readonly="true">
          </div>

          <div class="form-group">
            <label for="paymentAmount">Payment Amount (‚Çπ) *</label>
            <input id="paymentAmount" type="number" name="payment_amount" required step="0.01" placeholder="0.00"
              aria-required="true">
          </div>

          <div class="form-group">
            <label for="paymentMethod">Payment Method *</label>
            <select id="paymentMethod" name="payment_method" required aria-required="true">
              <option value="">Select method</option>
              <option value="cash">Cash</option>
              <option value="bank_transfer">Bank Transfer</option>
              <option value="check">Check</option>
              <option value="upi">UPI</option>
              <option value="card">Card</option>
            </select>
          </div>

          <div class="form-group">
            <label for="referenceNumber">Reference Number</label>
            <input id="referenceNumber" type="text" name="reference_number" placeholder="e.g., TXN123456 or Check #">
          </div>

          <div class="form-group">
            <label for="paymentDate">Payment Date *</label>
            <input id="paymentDate" type="date" name="payment_date" required aria-required="true">
          </div>

          <div class="form-group">
            <label for="paymentNotes">Notes</label>
            <input id="paymentNotes" type="text" name="notes" placeholder="Optional notes">
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closePaymentModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Record Payment</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Bill Payment Modal -->
    <div id="billModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true"
      aria-labelledby="billModalTitle" tabindex="-1">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="billModalTitle">Record Bill Payment</h2>
          <button type="button" class="close-btn" onclick="closeBillModal()"
            aria-label="Close bill dialog">&times;</button>
        </div>
        <form method="POST" action="{% url 'record_bill_payment_dashboard' %}" id="billForm">
          {% csrf_token %}
          <input type="hidden" name="bill_id" id="billId">

          <div class="form-group">
            <label for="billRoomDisplay">Room</label>
            <input type="text" id="billRoomDisplay" readonly style="background: #E8D7C3;" aria-readonly="true">
          </div>

          <div class="form-group">
            <label for="billPaymentAmount">Bill Payment Amount (‚Çπ) *</label>
            <input id="billPaymentAmount" type="number" name="bill_payment_amount" required step="0.01"
              placeholder="0.00" aria-required="true">
          </div>

          <div class="form-group">
            <label for="billPaymentDate">Payment Date *</label>
            <input id="billPaymentDate" type="date" name="bill_payment_date" required aria-required="true">
          </div>

          <div class="form-group">
            <label for="billNotes">Notes</label>
            <input id="billNotes" type="text" name="bill_notes" placeholder="Optional notes">
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeBillModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Record Payment</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>¬© 2025 Panesar PG Management System | Last Updated: {% now "M d, Y H:i" %}</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set today's date in all date inputs
      const today = new Date().toISOString().split('T')[0];
      const dateInputs = document.querySelectorAll('input[type="date"]');
      dateInputs.forEach(input => { if (!input.value) input.value = today; });

      // Modal helpers with ARIA support and defensive checks
      const paymentModal = document.getElementById('paymentModal');
      const billModal = document.getElementById('billModal');
      const paymentForm = document.getElementById('paymentForm');
      const billForm = document.getElementById('billForm');

      window.openPaymentModal = function(monthlyPaymentId, roomInfo) {
        const monthlyInput = document.getElementById('monthlyPaymentId');
        const roomDisplay = document.getElementById('roomDisplay');
        if (monthlyInput) monthlyInput.value = monthlyPaymentId || '';
        if (roomDisplay) roomDisplay.value = roomInfo || '';
        if (paymentModal) {
          paymentModal.style.display = 'block';
          paymentModal.setAttribute('aria-hidden','false');
          const amt = document.getElementById('paymentAmount');
          if (amt) amt.focus();
        }
      };

      window.closePaymentModal = function() {
        if (paymentModal) {
          paymentModal.style.display = 'none';
          paymentModal.setAttribute('aria-hidden','true');
        }
        if (paymentForm) paymentForm.reset();
      };

      window.openBillPaymentModal = function(billId, roomInfo) {
        const billInput = document.getElementById('billId');
        const billRoom = document.getElementById('billRoomDisplay');
        if (billInput) billInput.value = billId || '';
        if (billRoom) billRoom.value = roomInfo || '';
        if (billModal) {
          billModal.style.display = 'block';
          billModal.setAttribute('aria-hidden','false');
          const amt = document.getElementById('billPaymentAmount');
          if (amt) amt.focus();
        }
      };

      window.closeBillModal = function() {
        if (billModal) {
          billModal.style.display = 'none';
          billModal.setAttribute('aria-hidden','true');
        }
        if (billForm) billForm.reset();
      };

      // Close modal when clicking outside (defensive)
      window.addEventListener('click', function(event) {
        if (paymentModal && event.target === paymentModal) closePaymentModal();
        if (billModal && event.target === billModal) closeBillModal();
      });

      // Attach safe form validation handlers
      if (paymentForm) {
        paymentForm.addEventListener('submit', function(e) {
          const amountEl = document.getElementById('paymentAmount');
          const amount = amountEl ? amountEl.value : null;
          if (!amount || parseFloat(amount) <= 0) {
            e.preventDefault();
            alert('Please enter a valid payment amount');
            if (amountEl) amountEl.focus();
          }
        });
      }

      // Allow quick navigation to guest list filtered by room number
      window.viewRoomDetails = function(roomNumber) {
        if (!roomNumber) return;
        // Use the manage-guests search param to pre-fill the search box
        window.location.href = '/manage-guests/?search=' + encodeURIComponent(roomNumber);
      };

      if (billForm) {
        billForm.addEventListener('submit', function(e) {
          const amountEl = document.getElementById('billPaymentAmount');
          const amount = amountEl ? amountEl.value : null;
          if (!amount || parseFloat(amount) <= 0) {
            e.preventDefault();
            alert('Please enter a valid payment amount');
            if (amountEl) amountEl.focus();
          }
        });
      }
    });
  </script>
</body>

</html>